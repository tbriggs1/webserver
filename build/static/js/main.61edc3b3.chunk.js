(this["webpackJsonpmicrosoft-teams-ext"]=this["webpackJsonpmicrosoft-teams-ext"]||[]).push([[0],{126:function(e,t,n){},457:function(e,t,n){e.exports=n(687)},462:function(e,t,n){},575:function(e,t){},577:function(e,t){},588:function(e,t){},590:function(e,t){},617:function(e,t){},619:function(e,t){},620:function(e,t){},626:function(e,t){},628:function(e,t){},646:function(e,t){},649:function(e,t){},665:function(e,t){},668:function(e,t){},687:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(77),c=n.n(r),s=(n(462),n(126),n(40)),i=n(433),u=n(34),l=n(64),h=n(65),p=n(69),d=n(68),f=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h1",null,"Privacy Statement"))}}]),n}(o.a.Component),m=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h1",null,"Terms of Use"))}}]),n}(o.a.Component),b=n(98),v=n.n(b),g=n(182),k=n(87),E=n(63),O=n(201),y=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).ssoLoginSuccess=function(){var e=Object(g.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({ssoToken:t}),a.exchangeClientTokenForServerToken(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.exchangeClientTokenForServerToken=function(){var e=Object(g.a)(v.a.mark((function e(t){var n,o,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat("https://tbriggserver.co.uk","/getGraphAccessToken?ssoToken=").concat(t),e.next=3,fetch(n).catch(a.unhandledFetchError);case 3:return o=e.sent,e.next=6,o.json().catch(a.unhandledFetchError);case 6:r=e.sent,o.ok||"consent_required"!==r.error?o.ok?a.setState({graphAccessToken:r.access_token}):(console.error(r),a.setState({error:!0})):(a.setState({consentRequired:!0}),a.showConsentDialog());case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.componentDidUpdate=function(){var e=Object(g.a)(v.a.mark((function e(t,n){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:""===n.graphAccessToken&&""!==a.state.graphAccessToken&&a.callGraphFromClient();case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.callGraphFromClient=Object(g.a)(v.a.mark((function e(){var t,n,o,r,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.context.upn,n="https://graph.microsoft.com/v1.0/users/".concat(t,"/photo/$value"),o={method:"GET",headers:{"Content-Type":"image/jpg",authorization:"bearer "+a.state.graphAccessToken}},e.next=5,fetch(n,o).catch(a.unhandledFetchError);case 5:return(r=e.sent).ok||(console.error("ERROR: ",r),a.setState({error:!0})),e.next=9,r.blob().catch(a.unhandledFetchError);case 9:c=e.sent,a.setState({photo:URL.createObjectURL(c)});case 11:case"end":return e.stop()}}),e)}))),a.state={context:{},ssoToken:"",consentRequired:!1,consentProvided:!1,graphAccessToken:"",photo:"",error:!1},a.ssoLoginSuccess=a.ssoLoginSuccess.bind(Object(k.a)(a)),a.ssoLoginFailure=a.ssoLoginFailure.bind(Object(k.a)(a)),a.consentSuccess=a.consentSuccess.bind(Object(k.a)(a)),a.consentFailure=a.consentFailure.bind(Object(k.a)(a)),a.unhandledFetchError=a.unhandledFetchError.bind(Object(k.a)(a)),a.callGraphFromClient=a.callGraphFromClient.bind(Object(k.a)(a)),a.showConsentDialog=a.showConsentDialog.bind(Object(k.a)(a)),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;s.initialize(),s.getContext((function(t,n){e.setState({context:t})}));var t={successCallback:function(t){e.ssoLoginSuccess(t)},failureCallback:function(t){e.ssoLoginFailure(t)}};s.authentication.getAuthToken(t)}},{key:"ssoLoginFailure",value:function(e){console.error("SSO failed: ",e),this.setState({error:!0})}},{key:"showConsentDialog",value:function(){var e=this;s.authentication.authenticate({url:window.location.origin+"/auth-start",width:600,height:535,successCallback:function(t){e.consentSuccess(t)},failureCallback:function(t){e.consentFailure(t)}})}},{key:"consentSuccess",value:function(e){this.setState({graphAccessToken:e,consentProvided:!0})}},{key:"consentFailure",value:function(e){console.error("Consent failed: ",e),this.setState({error:!0})}},{key:"unhandledFetchError",value:function(e){console.error("Unhandled fetch error: ",e),this.setState({error:!0})}},{key:"render",value:function(){var e,t=Object.keys(this.state.context).length>0?"Congratulations "+this.state.context.upn+"! This is your tab":o.a.createElement(E.a,null),n=""===this.state.ssoToken?o.a.createElement(E.a,{label:"Performing Azure AD single sign-on authentication..."}):null,a=""===this.state.ssoToken||this.state.consentRequired||""!==this.state.photo?null:o.a.createElement(E.a,{label:"Exchanging SSO access token for Graph access token..."}),r=this.state.consentRequired&&!this.state.consentProvided?o.a.createElement(E.a,{label:"Consent required."}):null,c=""!==this.state.photo?o.a.createElement(O.a,{image:this.state.photo,size:"largest"}):null;return e=this.state.error?o.a.createElement("h1",null,"ERROR: Please ensure pop-ups are allowed for this website and retry"):o.a.createElement("div",null,o.a.createElement("h1",null,t),o.a.createElement("h3",null,n),o.a.createElement("h3",null,a),o.a.createElement("h3",null,r),o.a.createElement("h1",null,c)),o.a.createElement("div",null,e)}}]),n}(o.a.Component),j=n(432),w=n.n(j),S=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"componentDidMount",value:function(){s.initialize(),s.getContext((function(e,t){var n=e.tid,a={tenant:"".concat(n),client_id:"".concat("3d7dd1e1-141c-47a8-99a3-83d855033d28"),response_type:"token",scope:"https://graph.microsoft.com/User.Read",redirect_uri:window.location.origin+"/auth-end",nonce:w.a.randomBytes(16).toString("base64")},o="https://login.microsoftonline.com/".concat(n,"/oauth2/v2.0/authorize?")+(a=new URLSearchParams(a).toString());window.location.assign(o)}))}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h1",null,"Redirecting to consent page..."))}}]),n}(o.a.Component),C=n(448),x=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"componentDidMount",value:function(){s.initialize();var e=this.getHashParameters();e.access_token?s.authentication.notifySuccess(e.access_token):s.authentication.notifyFailure("Consent failed")}},{key:"getHashParameters",value:function(){var e={};return window.location.hash.substr(1).split("&").forEach((function(t){var n=t.split("="),a=Object(C.a)(n,2),o=a[0],r=a[1];e[o]=decodeURIComponent(r)})),e}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h1",null,"Consent flow complete."))}}]),n}(o.a.Component),T=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){return s.settings.registerOnSaveHandler((function(e){var t="https://".concat(window.location.hostname,":").concat(window.location.port);s.settings.setSettings({suggestedDisplayName:"My Tab",entityId:"Test",contentUrl:t+"/tab",websiteUrl:t+"/tab"}),e.notifySuccess()})),s.settings.setValidityState(!0),o.a.createElement("div",null,o.a.createElement("h1",null,"Tab Configuration"),o.a.createElement("div",null,"This is where you will add your tab configuration options the user can choose when the tab is added to your team/group chat."))}}]),n}(o.a.Component),F=function(){return o.a.createElement("div",null,o.a.createElement("h1",null,"Works"))};var R=function(){return s.initialize(),o.a.createElement(i.a,null,o.a.createElement(u.a,{exact:!0,path:"/privacy",component:f}),o.a.createElement(u.a,{exact:!0,path:"/termsofuse",component:m}),o.a.createElement(u.a,{exact:!0,path:"/tab",component:y}),o.a.createElement(u.a,{exact:!0,path:"/config",component:T}),o.a.createElement(u.a,{exact:!0,path:"/auth-start",component:S}),o.a.createElement(u.a,{exact:!0,path:"/auth-end",component:x}),o.a.createElement(u.a,{exact:!0,path:"/test",component:F}))},L=n(207),A=n(318);c.a.render(o.a.createElement(L.a,{theme:A.themes.teams},o.a.createElement(R,null)),document.getElementById("root"))}},[[457,1,2]]]);
//# sourceMappingURL=main.61edc3b3.chunk.js.map